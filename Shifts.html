<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <title>ูุธุงู ุงูุฅูุชุงุฌูุฉ ูุงูููุงูุจุงุช</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <div id="authScreen" style="position:fixed; inset:0; background:rgba(15,23,42,0.98); z-index:2500; display:grid; place-items:center; padding: 20px;">
    <div id="loginForm" class="auth-box">
      <h2 style="color:var(--primary); margin-bottom:20px;">๐ ุชุณุฌูู ุงูุฏุฎูู</h2>
      <input type="email" id="email" class="form-control" placeholder="ุงูุจุฑูุฏ ุงูุฅููุชุฑููู" style="margin-bottom:10px">
      <input type="password" id="password" class="form-control" placeholder="ูููุฉ ุงููุฑูุฑ" style="margin-bottom:10px">
      <button class="btn-primary" onclick="signIn()">ุฏุฎูู</button>
      <div class="auth-toggle" onclick="toggleAuthMode()">ููุณ ูุฏูู ุญุณุงุจุ ุทูุจ ุชุณุฌูู</div>
      <div id="authMsg" class="text-danger" style="margin-top:10px; font-size:12px; color:var(--danger)"></div>
    </div>
    <div id="registerForm" class="auth-box hidden">
      <h2 style="color:var(--success); margin-bottom:20px;">๐ ุทูุจ ุงูุถูุงู</h2>
      <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:10px">
          <input type="text" id="reg_rank" class="form-control" placeholder="ุงูุฑุชุจุฉ">
          <input type="text" id="reg_name" class="form-control" placeholder="ุงูุงุณู">
      </div>
      <input type="email" id="reg_email" class="form-control" placeholder="ุงูุจุฑูุฏ ุงูุฅููุชุฑููู" style="margin-bottom:10px">
      <input type="password" id="reg_pass" class="form-control" placeholder="ูููุฉ ุงููุฑูุฑ" style="margin-bottom:10px">
      <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:10px">
          <select id="reg_hall" class="form-control">
              <option value="" disabled selected>ุงูุตุงูุฉ (ุงุฎุชูุงุฑู)</option>
              <option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option>
          </select>
          <select id="reg_shift" class="form-control">
              <option value="" disabled selected>ุงูููุงูุจุฉ (ุงุฎุชูุงุฑู)</option>
              <option value="ุฃ">ุฃ</option><option value="ุจ">ุจ</option><option value="ุฌ">ุฌ</option><option value="ุฏ">ุฏ</option>
          </select>
      </div>
      <select id="reg_type" class="form-control" style="margin-bottom:15px">
          <option value="departure" selected>ูุบุงุฏุฑุฉ</option>
          <option value="arrival">ูุฏูู</option>
      </select>
      <button class="btn-primary" style="background:var(--success)" onclick="signUp()">ุฅุฑุณุงู ุงูุทูุจ</button>
      <button class="btn-secondary" onclick="toggleAuthMode()">ุฑุฌูุน ูุชุณุฌูู ุงูุฏุฎูู</button>
      <div id="regMsg" class="text-danger" style="margin-top:10px; font-size:12px;"></div>
    </div>
  </div>

  <button id="mobileMenuBtn" onclick="toggleSidebar()">โฐ</button>
  <div id="mobileOverlay" class="app-overlay" onclick="toggleSidebar()"></div>

  <div class="app-container">
    <aside class="sidebar" id="mainSidebar">
      <div class="brand">
        <div class="brand-icon">
            <img src="https://my.gov.sa/files/agency_files/qtrn0va83ei17h9cfkg70eywf1d14fwq.png" alt="Logo">
        </div>
        <div><b>ุงูุฅูุชุงุฌูุฉ</b><div style="font-size:11px;color:var(--text-muted)">ุฅุฏุงุฑุฉ ุงูููุงูุจุงุช</div></div>
      </div>
      <nav style="display:flex; flex-direction:column; gap:5px; width:100%">
        <div class="nav-item active" onclick="go('daily')" id="nav-daily"><span>๐</span> ุงูุญุถูุฑ ุงููููู</div>
        <div class="nav-item" onclick="go('monthly')" id="nav-monthly"><span>โ๏ธ</span> ุฅูุชุงุฌูุฉ ุงููุณุงูุฑูู</div>
        <div class="nav-item" onclick="go('record')" id="nav-record"><span>๐</span> ุณุฌู ุงููุฑุฏ</div>
        <div class="nav-item" onclick="go('stats')" id="nav-stats"><span>๐</span> ุงูุฅุญุตุงุฆูุงุช ุงูุนุงูุฉ</div>
        <div class="nav-item" onclick="go('absence')" id="nav-absence"><span>๐ซ</span> ูุณู ุงูุบูุงุจ</div>
        <div class="nav-item" onclick="go('manage')" id="nav-manage"><span>โ๏ธ</span> ููู / ุชุนุฏูู</div>
        <div class="nav-item hidden" onclick="go('requests')" id="nav-requests" style="border-color:var(--warning); color:var(--warning)">
            <span>๐</span> ุทูุจุงุช ุงูุงูุถูุงู
            <div id="reqBadge" class="nav-badge hidden"></div>
        </div>
      </nav>
      <div class="user-info" id="userDisplayName"></div>
      <button class="btn-secondary" onclick="logout()" style="margin:20px">ุฎุฑูุฌ</button>
    </aside>

    <main class="main-content">
      <header class="top-header">
        <div style="font-weight:800; font-size:18px" id="pageTitle">ุชุณุฌูู ุงูููุงูุจุฉ</div>
        <div style="font-size:13px; color:var(--productivity)" id="dateNow"></div>
      </header>
      <div class="content-scroll">

        <div id="sec-daily" class="section active">
          <div class="grid-filters">
            <div>
                <label>ุงูุชุงุฑูุฎ</label>
                <input type="date" id="d_date" class="form-control date-hijri-picker">
                <span id="d_date_hijri" class="hijri-display"></span>
            </div>
            <div><label>ุงูุตุงูุฉ</label><select id="d_hall" class="form-control" onchange="loadDailyData()"></select></div>
            <div><label>ุงูููุงูุจุฉ</label><select id="d_shift" class="form-control" onchange="loadDailyData()"></select></div>
            <div><label>ุงูููุน</label><select id="d_type" class="form-control" onchange="loadDailyData()"></select></div>
          </div>
          <div style="background:var(--bg-card); padding:15px; border-radius:var(--radius); border:1px solid var(--border)">
             <div class="instruction-hint">โ๏ธ ุชูุจูู: ุงููุฑ ุนูู ููุน ุงูููุงุญุธุฉ ุงููุทููุจุฉ (ุญุถูุฑุ ุบูุงุจ...) ูุจู ุงุฎุชูุงุฑ ุงูุฃุณูุงุก ูู ุงููุงุฆูุฉ.</div>
             <div class="status-selector" id="statusRadios"></div>
             
             <div id="otherInputDiv" class="hidden other-input-container" style="margin-top:10px; border-top:1px solid var(--border); padding-top:10px;">
                <div style="text-align:center; margin-bottom:5px; font-size:12px; font-weight:bold;">ูู ุชุนุชุจุฑ ูุฎุงููุฉุ</div>
                <div class="violation-toggle">
                    <div class="v-option active" data-val="no" onclick="setViolation(false, this)">ููุณุช ูุฎุงููุฉ โ</div>
                    <div class="v-option" data-val="yes" onclick="setViolation(true, this)">ูุฎุงููุฉ โ</div>
                </div>
                <label style="font-size:12px; color:var(--text-muted)">๐ ุงูุชุจ ููุน ุงูุญุงูุฉ:</label>
                <input type="text" id="status_manual_text" class="form-control" placeholder="ูุตู ุงูุญุงูุฉ...">
             </div>

             <div id="appInputDiv" class="hidden other-input-container" style="margin-top:10px; border-top:1px solid var(--border); padding-top:10px;">
                <label style="font-size:12px; color:var(--text-muted)">๐ ุณุจุจ ุงูุชุทุจูู:</label>
                <input type="text" id="app_reason_text" class="form-control" placeholder="ุงูุชุจ ุณุจุจ ุงูุชุทุจูู ููุง...">
             </div>

          </div>
          <div class="transfer-area">
            <div class="list-panel">
              <div class="panel-header"><span>ุงููุชุงุญ (<span id="c-pool">0</span>)</span> <button class="btn-secondary" onclick="moveAll()">ุงููู โฌ๏ธ</button></div>
              <div class="list-box" id="list-pool"></div>
            </div>
            <div class="list-panel" style="border-color:var(--primary)">
              <div class="panel-header"><span>ุชู ุงูุชุญุถูุฑ (<span id="c-chosen">0</span>)</span> <button class="btn-secondary" onclick="clearChosen()">ุฅุฑุฌุงุน โก๏ธ</button></div>
              <div class="list-box" id="list-chosen"></div>
            </div>
          </div>
          <div style="margin-top:15px; display:flex; gap:10px; flex-wrap:wrap">
            <button class="btn-primary" onclick="submitDaily()" style="flex:2">๐พ ุญูุธ ุชุญุถูุฑ ุงูููุงูุจุฉ</button>
            <button class="btn-secondary" onclick="toggleSubmittedList()" style="flex:1; border-color:var(--success); color:var(--success)">๐๏ธ ุนุฑุถ ุงููุฑููุน ุงูููู</button>
          </div>
          <div id="dailyMsg" style="margin-top:10px"></div>
          
          <div id="submitted-area" class="submitted-section hidden">
              <h4 style="margin:0 0 10px 0; color:var(--text-muted)">๐ ุชู ุฑูุนูู ููุฐุง ุงูููู ( <span id="sub-count">0</span> )</h4>
              <div id="submitted-list"></div>
          </div>
        </div>

        <div id="sec-monthly" class="section">
          <div class="grid-filters">
            <div><label>ุงูุณูุฉ</label><input type="number" id="m_year" class="form-control" value="2026"></div>
            <div><label>ุงูุดูุฑ</label><select id="m_month" class="form-control"></select></div>
            <div><label>ุงูุตุงูุฉ</label><select id="m_hall_filter" class="form-control" onchange="loadMonthlyEntry()"></select></div>
            <div><label>ุงูููุงูุจุฉ</label><select id="m_shift_filter" class="form-control" onchange="loadMonthlyEntry()"></select></div>
            <div><label>ุงูููุน</label><select id="m_type_filter" class="form-control" onchange="loadMonthlyEntry()"></select></div>
            <div style="display:flex; align-items:flex-end"><button class="btn-primary" onclick="loadMonthlyEntry()">ุนุฑุถ ุงููุงุฆูุฉ</button></div>
          </div>
          <div class="stats-card">
            <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid var(--border); padding-bottom:15px; margin-bottom:15px;">
              <h3 style="margin:0">โ๏ธ ุฑุตุฏ ุนุฏุฏ ุงููุณุงูุฑูู</h3>
              <div style="display:flex; align-items:center; gap:10px">
                  <span id="saveStatusSpan" style="color:var(--success); font-weight:bold; font-size:13px; opacity:0; transition:opacity 0.5s">ุชู ุงูุญูุธ ุจูุฌุงุญ โ</span>
                  <button class="btn-primary" onclick="submitMonthlyScores()">๐พ ุญูุธ ุงูุฃุฑูุงู</button>
              </div>
            </div>
            <div style="overflow-x:auto;">
              <table class="score-table">
                <thead><tr><th style="text-align:right">ุงูุงุณู</th><th>ุงูุฑุชุจุฉ</th><th>ุงูุนุฏุฏ ุงูุญุงูู</th><th>ุชุนุฏูู ุงูุนุฏุฏ</th></tr></thead>
                <tbody id="monthlyBody"></tbody>
              </table>
            </div>
            <div id="monthlyMsg" style="margin-top:10px"></div>
          </div>
        </div>

        <div id="sec-record" class="section">
          <div class="grid-filters">
            <div><label>ุงูุตุงูุฉ</label><select id="rec_hall" class="form-control" onchange="filterRecSelect()"></select></div>
            <div><label>ุงูููุงูุจุฉ</label><select id="rec_shift" class="form-control" onchange="filterRecSelect()"></select></div>
            <div><label>ุงูููุน</label><select id="rec_type" class="form-control" onchange="filterRecSelect()"></select></div>
            <div><label>ุจุญุซ ุจุงูุงุณู</label><input type="text" id="rec_search_text" class="form-control" placeholder="ุงูุชุจ ุงูุงุณู..." onkeyup="filterRecSelect()"></div>
            <div style="flex:2"><label>ุงุฎุชุฑ ุงููุฑุฏ</label><select id="rec_emp_select" class="form-control"></select></div>
            <div style="display:flex; align-items:flex-end"><button class="btn-primary" onclick="loadSoldierRecord()">ุนุฑุถ ุงูุณุฌู</button></div>
          </div>

          <div id="soldier-profile" class="hidden">
            <div class="profile-header">
                
                <div class="profile-right-section">
                    <div class="profile-avatar">๐จโโ๏ธ</div>
                    <div class="profile-details">
                        <div>
                            <h2 id="p_name" style="margin:0; font-size:18px; line-height:1.2;"></h2>
                            <div style="font-size:12px; color:var(--text-muted); margin-top:2px;">
                                <span id="p_rank" style="color:var(--primary); font-weight:bold"></span> | 
                                <span id="p_loc"></span>
                            </div>
                        </div>

                        <div class="profile-stat-group">
                            <div class="mini-stat">
                                <div class="val" id="p_count_absent" style="color:var(--danger)">0</div>
                                <div class="lbl">ุบูุงุจ</div>
                            </div>
                            <div class="mini-stat">
                                <div class="val" id="p_count_absent_excused" style="color:#fcd34d">0</div>
                                <div class="lbl">ุบูุงุจ ุจุนุฐุฑ</div>
                            </div>
                            <div class="mini-stat">
                                <div class="val" id="p_count_late" style="color:var(--warning)">0</div>
                                <div class="lbl">ุชุฃุฎูุฑ</div>
                            </div>
                            <div class="mini-stat">
                                <div class="val" id="p_count_early" style="color:var(--success)">0</div>
                                <div class="lbl">ูุจูุฑ</div>
                            </div>
                            <div class="mini-stat">
                                <div class="val" id="p_count_vio" style="color:var(--danger)">0</div>
                                <div class="lbl">ูุฎุงููุงุช</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="productivity-box">
                    <div style="font-size:10px; color:var(--productivity); margin-bottom:4px; font-weight:bold;">ุงูุฅูุชุงุฌูุฉ</div>
                    <div style="font-size:22px; font-weight:800; color:var(--text-main)" id="p_total_prod">0</div>
                </div>

            </div>
            
            <div class="record-grid">
                <div class="stats-card" style="display:flex; flex-direction:column; align-items:center; margin:0">
                     <h3 style="margin:0 0 15px 0; align-self:flex-start; font-size:14px;">๐งญ ูุณุชูู ุงูุงูุถุจุงุท</h3>
                     <div class="gauge-container">
                         <svg class="gauge-svg" viewBox="0 0 200 100">
                             <path class="gauge-arc-bg" d="M20 90 A 80 80 0 0 1 180 90" />
                             <path id="p_gauge_arc" class="gauge-arc-val" d="M20 90 A 80 80 0 0 1 180 90" stroke-dasharray="0, 251" />
                             <polygon id="p_gauge_needle" class="gauge-needle" points="100,90 95,90 100,20 105,90" />
                             <circle cx="100" cy="90" r="5" class="gauge-center" />
                         </svg>
                         <div id="p_gauge_text" class="gauge-text" style="margin-top:-10px">0%</div>
                         <div id="p_gauge_reason" class="gauge-reason" style="color:var(--text-muted)">--</div>
                     </div>
                </div>

                <div class="stats-card doughnut-card" style="margin:0">
                    <div class="doughnut-wrapper">
                        <div id="p_doughnut" class="doughnut-container"></div>
                        <div class="doughnut-hole">
                            <div class="doughnut-number" id="p_total_events">0</div>
                            <div class="doughnut-label">ุญุงูุฉ</div>
                        </div>
                    </div>
                    <div id="p_doughnut_legend" class="doughnut-legend"></div>
                </div>

                <div class="stats-card" style="margin:0">
                  <div style="font-weight:bold; font-size:14px; margin-bottom:15px">๐ ุงูุฑุณู ุงูุจูุงูู (ุงูุณููู)</div>
                  <div id="p_chart_container" style="display:flex; align-items:flex-end; height:120px; gap:6px; padding-bottom:10px; border-bottom:1px solid var(--border)"></div>
                  <div style="display:flex; justify-content:space-between; margin-top:5px; font-size:9px; color:var(--text-muted)" id="p_chart_labels"></div>
                </div>
            </div>

            <div class="stats-card">
              <div style="font-weight:bold; margin-bottom:10px; font-size:14px">ุณุฌู ุงูุญุถูุฑ ูุงูุบูุงุจ (ูุฌุฑู)</div>
              <div style="max-height:300px; overflow-y:auto">
                <table class="score-table">
                  <thead><tr><th>ุงูุชุงุฑูุฎ ุงููุฌุฑู</th><th>ุงูุญุงูุฉ</th><th>ููุงุญุธุฉ</th></tr></thead>
                  <tbody id="p_history"></tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

   <div id="sec-absence" class="section">
            <div class="grid-filters">
                <div><label>ุงูุตุงูุฉ</label><select id="ab_hall" class="form-control" onchange="loadAbsenceSection()"></select></div>
                <div><label>ุงูููุงูุจุฉ</label><select id="ab_shift" class="form-control" onchange="loadAbsenceSection()"></select></div>
                <div><label>ุงูููุน</label><select id="ab_type" class="form-control" onchange="loadAbsenceSection()"></select></div>
                <div style="display:flex; align-items:flex-end"><button class="btn-primary" onclick="loadAbsenceSection()">ุชุญุฏูุซ ุงููุงุฆูุฉ</button></div>
            </div>
            <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(300px, 1fr)); gap:20px">
                <div class="stats-card" style="height:fit-content">
                    <h3 style="margin:0 0 15px 0; border-bottom:1px solid var(--border); padding-bottom:10px">โ๏ธ ูุงุฆูุฉ ุงููุชุบูุจูู (ุจุฏูู ุนุฐุฑ)</h3>
                    <div id="absentEmployeesList" style="max-height:400px; overflow-y:auto">
                        <p style="color:var(--text-muted); font-size:12px">ุฌุงุฑู ุงูุชุญููู...</p>
                    </div>
                </div>

                <div class="stats-card">
                    <h3 style="margin:0 0 15px 0; border-bottom:1px solid var(--border); padding-bottom:10px">๐ ุชูุงุตูู ุงูุบูุงุจ ูุงูุฅุฌุฑุงุกุงุช</h3>
                    <div id="sickActionPanel" class="hidden">
                        <div id="sickTargetName" style="font-weight:bold; color:var(--primary); font-size:16px; margin-bottom:5px"></div>
                        <div id="sickTargetInfo" style="font-size:12px; color:var(--text-muted); margin-bottom:15px"></div>
                        
                        <label style="font-size:12px; margin-bottom:5px; display:block">ุงุฎุชุฑ ุชุงุฑูุฎ ุงูุบูุงุจ ูููุนุงูุฌุฉ:</label>
                        <select id="sickDateSelect" class="form-control" style="margin-bottom:15px"></select>

                       <div style="background:rgba(59, 130, 246, 0.05); padding:15px; border-radius:10px; border:1px solid var(--border); text-align:center">
                        <p style="font-size:12px; margin:0 0 10px 0; color:var(--text-main)">ูู ููุฌุฏ ุนุฐุฑ ููุจูู ููุบูุงุจุ</p>
                        <div style="display:flex; gap:10px; justify-content:center; flex-wrap: wrap;"> 
                            <button class="btn-primary" style="font-weight:bold; font-size:12px;" onclick="markAsExcused()">โ ูุนู ูุชู ุงูุฑูุน ูู ุฎุฏูุงุชู ูุงูุชุงูุฏ ููู</button>
                            <button class="btn-danger" style="font-weight:bold; font-size:12px;" onclick="markAsUnexcused()">โ ุบูุงุจ ุจุฏูู ุนุฐุฑ</button>
                        </div>
                    </div>
                    </div>
                    <div id="sickPlaceholder" style="text-align:center; padding:30px; color:var(--text-muted); font-size:13px">
                        ุงุฎุชุฑ ููุธูุงู ูู ุงููุงุฆูุฉ ูุนุฑุถ ุงูุชูุงุตูู
                    </div>
                </div>
            </div>

            <div class="stats-card" style="margin-top:20px">
                <h3 style="margin:0 0 15px 0">๐ ุณุฌู ุงูุญุงูุงุช ุงูุชู ุชู ูุนุงูุฌุชูุง</h3>
                <div style="overflow-x:auto">
                    <table class="score-table">
                        <thead><tr><th>ุงูุงุณู</th><th>ุงูุชุงุฑูุฎ (ูุฌุฑู)</th><th>ุงูุญุงูุฉ ุงูุญุงููุฉ</th><th>ุงูููุงุญุธุฉ</th><th>ุฅุฌุฑุงุก</th></tr></thead>
                        <tbody id="sickLogBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="sec-stats" class="section">
          <div class="grid-filters">
            <div>
                <label>ูู</label>
                <input type="date" id="st_from" class="form-control date-hijri-picker">
                <span id="st_from_hijri" class="hijri-display"></span>
            </div>
            <div>
                <label>ุฅูู</label>
                <input type="date" id="st_to" class="form-control date-hijri-picker">
                <span id="st_to_hijri" class="hijri-display"></span>
            </div>
            <div><label>ุงูุตุงูุฉ</label><select id="st_hall" class="form-control"></select></div>
            <div><label>ุงูููุงูุจุฉ</label><select id="st_shift" class="form-control"></select></div>
            <div><label>ุงูููุน</label><select id="st_type" class="form-control"></select></div>
            <div style="display:flex; align-items:flex-end"><button class="btn-primary" onclick="loadGeneralStats()">ุชุญุฏูุซ ุงููุคุดุฑุงุช</button></div>
          </div>
          
          <div class="stats-card" style="margin-bottom:20px;">
              <h3 style="margin:0 0 10px 0;">๐ ุงูุฎุท ุงูุฒููู ููุงูุถุจุงุท (ุขุฎุฑ 30 ููู)</h3>
              <div class="legend-box">
                  <div class="legend-item"><div class="dot" style="background:#1e3a8a"></div> ุฅุฌูุงูู</div>
                  <div class="legend-item"><div class="dot" style="background:var(--success)"></div> ุงูุถุจุงุท</div>
                  <div class="legend-item"><div class="dot" style="background:var(--danger)"></div> ูุฎุงููุงุช</div>
              </div>
              <div class="timeline-wrapper">
                  <div id="timeline_chart" class="timeline-container"></div>
              </div>
          </div>

          <div class="stats-card" style="display:flex; flex-direction:column; align-items:center; margin-bottom:20px;">
                <h3 style="margin:0 0 10px 0; align-self:flex-start">๐ ูุคุดุฑ ุงูุงูุถุจุงุท ุงูุนุงู ูููุธุงู</h3>
                <div class="gauge-container">
                    <svg class="gauge-svg" viewBox="0 0 200 100">
                        <path class="gauge-arc-bg" d="M20 90 A 80 80 0 0 1 180 90" />
                        <path id="g_gauge_arc" class="gauge-arc-val" d="M20 90 A 80 80 0 0 1 180 90" stroke-dasharray="0, 251" />
                        <polygon id="g_gauge_needle" class="gauge-needle" points="100,90 95,90 100,20 105,90" />
                        <circle cx="100" cy="90" r="5" class="gauge-center" />
                    </svg>
                    <div id="g_gauge_text" class="gauge-text" style="margin-top:-10px">0%</div>
                    <div id="g_gauge_reason" class="gauge-reason" style="color:var(--text-muted)">--</div>
                </div>
          </div>
          <div class="kpi-row">
            <div class="kpi-box" style="border-top:3px solid var(--productivity)">
              <div class="kpi-lbl">ุฅุฌูุงูู ุงููุณุงูุฑูู</div>
              <div class="kpi-val" id="g_total_prod" style="color:var(--productivity)">0</div>
            </div>
            <div class="kpi-box" style="border-top:3px solid var(--danger)">
              <div class="kpi-lbl">ุฃูุซุฑ ุตุงูุฉ ุบูุงุจ</div>
              <div class="kpi-val" id="g_most_absent" style="color:var(--danger); font-size:16px">-</div>
              <div style="font-size:10px; color:var(--text-muted)" id="g_most_absent_count"></div>
            </div>
            <div class="kpi-box" style="border-top:3px solid var(--success)">
              <div class="kpi-lbl">ุฃูุซุฑ ุตุงูุฉ ุงูุถุจุงุท</div>
              <div class="kpi-val" id="g_most_disciplined" style="color:var(--success); font-size:16px">-</div>
              <div style="font-size:10px; color:var(--text-muted)" id="g_most_disciplined_count"></div>
            </div>
            <div class="kpi-box" style="border-top:3px solid var(--danger)">
              <div class="kpi-lbl">ุฃูุซุฑ ุตุงูุฉ ูุฎุงููุงุช</div>
              <div class="kpi-val" id="g_most_violations" style="color:var(--danger); font-size:16px">-</div>
              <div style="font-size:10px; color:var(--text-muted)" id="g_most_violations_count"></div>
            </div>
          </div>
          
          <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(350px, 1fr)); gap:20px">
            <div class="stats-card">
              <h3>๐ ุงูุฃุนูู ุฅูุชุงุฌูุฉ (ูุณุงูุฑูู)</h3>
              <div id="prod_leaderboard" class="bar-chart-container"></div>
            </div>
            
            <div class="stats-card">
              <h3>๐๏ธ ุงูุฃุนูู ุงูุถุจุงุทุงู (ุชูุตููู)</h3>
              <p style="font-size:10px; color:var(--text-muted)">ุงููุนูุงุฑ: ุงูุญุถูุฑ ุงููุจูุฑ (ุฃุนูู ููุงุท) > ููุฉ ุงููุฎุงููุงุช > ุงูุฅูุชุงุฌูุฉ</p>
              <div id="discipline_leaderboard" class="bar-chart-container"></div>
            </div>

            <div class="stats-card">
              <h3>โ๏ธ ุงูุฃูุซุฑ ูุฎุงููุงุช (ุงูุนุฏุฏ)</h3>
              <div id="violations_leaderboard" class="bar-chart-container"></div>
            </div>

            <div class="stats-card">
              <h3>โ ูุงุฆูุฉ ุงูุฃูุซุฑ ุบูุงุจุงู</h3>
              <div id="absent_leaderboard" class="bar-chart-container"></div>
            </div>

            <div class="stats-card" style="grid-column: 1 / -1;">
              <h3>ุชุญููู ุงูุญุงูุงุช (ุดุงูู)</h3>
              <p style="font-size:11px; color:var(--text-muted); margin-bottom:15px">ุงููุฑ ุนูู ุงูุญุงูุฉ ูุนุฑุถ ุงูุชูุงุตูู</p>
              <div id="status_breakdown"></div>
            </div>
          </div>
        </div>

        <div id="sec-requests" class="section">
            <div class="stats-card">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px">
                    <h3>๐จโ๐ป ุทูุจุงุช ุงูุงูุถูุงู ุงูุฌุฏูุฏุฉ</h3>
                    <button class="btn-primary" style="width:auto; padding:5px 15px; font-size:12px" onclick="approveAllUsers()">โ ูุจูู ุงููู</button>
                </div>
                <div id="requestsList">
                    <p style="color:var(--text-muted)">ุฌุงุฑู ุงูุจุญุซ...</p>
                </div>
            </div>
            <div class="stats-card" style="margin-top:20px">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px">
                    <h3>๐ฅ ุฅุฏุงุฑุฉ ุฌููุน ุงููุณุชุฎุฏููู</h3>
                    <button class="btn-secondary" style="width:auto; padding:5px 15px; font-size:12px; margin:0" onclick="toggleAllUsersList()">๐๏ธ ุนุฑุถ ุงูุฃุณูุงุก</button>
                </div>
                <div id="allUsersContainer" class="hidden">
                    <div id="allUsersList">
                        <p style="color:var(--text-muted)">ุฌุงุฑู ุงูุชุญููู...</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="sec-manage" class="section">
           <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(350px, 1fr)); gap:20px">
              <div class="stats-card">
                <h3>๐ ููู ุงูุฃูุฑุงุฏ</h3>
                <div style="margin:15px 0">
                    <label>ุจุญุซ ุนู ูุฑุฏ</label>
                    <input type="text" id="search_move_emp" class="form-control" placeholder="ุงูุชุจ ุงูุงุณู ููุจุญุซ..." onkeyup="filterMoveSelect()" style="margin-bottom:5px">
                    <select id="m_emp" class="form-control"></select>
                </div>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px">
                  <div><label>ุฅูู ุตุงูุฉ</label><select id="m_new_hall" class="form-control"></select></div>
                  <div><label>ุฅูู ููุงูุจุฉ</label><select id="m_new_shift" class="form-control"></select></div>
                </div>
                <div style="margin-top:10px"><label>ุฅูู ููุน</label><select id="m_new_type" class="form-control"></select></div>
                <button class="btn-primary" style="margin-top:15px; width:100%" onclick="moveEmployee()">ุชูููุฐ ุงูููู</button>
                <div id="moveMsg" style="margin-top:10px"></div>
              </div>

              <div class="stats-card">
                <h3>โ / ๐๏ธ ุฅุฏุงุฑุฉ ุงูุฃูุฑุงุฏ (ุฅุถุงูุฉ/ุญุฐู)</h3>
                
                <div style="border-bottom:1px solid var(--border); padding-bottom:15px; margin-bottom:15px">
                    <h4 style="margin:0 0 10px 0; color:var(--success)">ุฅุถุงูุฉ ูุฏููุฉ</h4>
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px">
                        <input type="text" id="add_name" class="form-control" placeholder="ุงูุงุณู" style="font-size:13px">
                        <input type="text" id="add_rank" class="form-control" placeholder="ุงูุฑุชุจุฉ" style="font-size:13px">
                    </div>
                    <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:8px; margin-top:8px">
                        <select id="add_hall" class="form-control" style="font-size:13px"><option value="1">ุต1</option><option value="2">ุต2</option><option value="3">ุต3</option><option value="4">ุต4</option><option value="5">ุต5</option></select>
                        <select id="add_shift" class="form-control" style="font-size:13px"><option value="ุฃ">ุฃ</option><option value="ุจ">ุจ</option><option value="ุฌ">ุฌ</option><option value="ุฏ">ุฏ</option></select>
                        <select id="add_type" class="form-control" style="font-size:13px"><option value="arrival">ูุฏูู</option><option value="departure" selected>ูุบุงุฏุฑุฉ</option></select>
                    </div>
                    <button class="btn-primary" style="margin-top:10px; background:var(--success)" onclick="addNewEmployeeManual()">+ ุฅุถุงูุฉ ูููุดู</button>
                </div>

                <div>
                    <h4 style="margin:0 0 10px 0; color:var(--danger)">ุญุฐู ููุงุฆู</h4>
                    <label>ุจุญุซ ุนู ูุฑุฏ ููุญุฐู</label>
                    <input type="text" id="search_del_emp" class="form-control" placeholder="ุงูุชุจ ุงูุงุณู ููุจุญุซ..." onkeyup="filterDeleteSelect()" style="margin-bottom:5px">
                    <select id="del_emp_select" class="form-control"></select>
                    <button class="btn-danger" style="margin-top:10px; width:100%" onclick="deleteEmployeeManual()">๐๏ธ ุญุฐู ุงููุฑุฏ</button>
                </div>
              </div>

              <div class="stats-card">
                  <h3>โ๏ธ ุชุนุฏูู ุฅุญุตุงุฆูุฉ (ุฅูุชุงุฌูุฉ)</h3>
                  <div class="grid-filters" style="padding:10px; background:rgba(0,0,0,0.2); grid-template-columns: 1fr 1fr; margin-bottom:10px">
                      <div><label>ุงูุณูุฉ</label><input type="number" id="e_year" class="form-control" value="2026"></div>
                      <div><label>ุงูุดูุฑ</label><select id="e_month" class="form-control"></select></div>
                  </div>
                  <div style="margin-bottom:10px">
                      <label>ุจุญุซ ุนู ูุฑุฏ</label>
                      <input type="text" id="e_search" class="form-control" placeholder="ุงูุงุณู..." onkeyup="filterEditSelect()">
                  </div>
                  <div style="margin-bottom:10px"><select id="e_emp_select" class="form-control" onchange="fetchStatForEdit()"></select></div>
                  <div id="editStatArea" class="hidden" style="margin-top:15px; border-top:1px solid var(--border); padding-top:15px">
                      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px">
                          <span>ุงูุฏุฑุฌุฉ ุงูุญุงููุฉ:</span>
                          <input type="number" id="e_score_val" class="score-input" style="width:100px; font-size:16px">
                      </div>
                      <div style="display:flex; gap:10px">
                          <button class="btn-primary" style="flex:1" onclick="updateStat()">ุชุญุฏูุซ</button>
                          <button class="btn-danger" onclick="deleteStat()">ุญุฐู</button>
                      </div>
                  </div>
                  <div id="editMsg" style="margin-top:10px"></div>
              </div>
           </div>
        </div>

      </div>
    </main>
  </div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="script.js"></script>
</body>
</html>